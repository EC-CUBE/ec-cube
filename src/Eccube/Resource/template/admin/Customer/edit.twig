{#
/*
* This file is part of EC-CUBE
*
* Copyright(c) 2000-2015 LOCKON CO.,LTD. All Rights Reserved.
*
* http://www.lockon.co.jp/
*
* This program is free software; you can redistribute it and/or
* modify it under the terms of the GNU General Public License
* as published by the Free Software Foundation; either version 2
* of the License, or (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program; if not, write to the Free Software
* Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
*/
#}

{% extends 'default_frame.twig' %}

{% set menus = ['customer', 'customer_edit'] %}

{% block title %}会員管理{% endblock %}
{% block sub_title %}会員登録・編集{% endblock %}

{% form_theme form 'Form/bootstrap_3_horizontal_layout.html.twig' %}

{% block javascript %}
<script src="//yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
{% endblock javascript %}

{% block main %}
<div class="row" id="aside_wrap">
    <form name="customer_form" role="form" id="customer_form" method="post" action="{%- if Customer.id %}{{ url('admin_customer_edit', { id : Customer.id }) }}{% else %}{{ url('admin_customer_new') }}{% endif -%}" novalidate class="h-adr">
        <span class="p-country-name" style="display:none;">Japan</span>
        {{ form_widget(form._token) }}
        <div id="detail_wrap" class="col-md-9">
            <div id="detail_box" class="box accordion">
                <div id="detail_box__header" class="box-header toggle active">
                    <h3 class="box-title">会員情報<svg class="cb cb-angle-down icon_down"> <use xlink:href="#cb-angle-down" /></svg></h3>
                </div><!-- /.box-header -->
                <div id="detail_box__body" class="box-body accpanel" style="display: block;">
                    <div class="form-horizontal">
                        {# 会員ID #}
                        {% if Customer.id %}
                        <div id="detail_box__id" class="form-group">
                            <label class="col-sm-3 col-lg-2 control-label">会員ID</label>
                            <div class="col-sm-9 col-lg-10">{{ Customer.id }}</div>
                        </div>
                        {% endif %}
                        {# 名前 #}
                        <div id="detail_box__name" class="form-group">
                            {{ form_label(form.name) }}
                            <div class="col-sm-9 col-lg-10 input_name form-inline">
                                {{ form_widget(form.name.name01) }}
                                {{ form_widget(form.name.name02) }}
                                {{ form_errors(form.name.name01) }}
                                {{ form_errors(form.name.name02) }}
                            </div>
                        </div>
                        {# 名前(カナ) #}
                        <div id="detail_box__kana" class="form-group">
                            {{ form_label(form.kana) }}
                            <div class="col-sm-9 col-lg-10 input_name form-inline">
                                {{ form_widget(form.kana.kana01) }}
                                {{ form_widget(form.kana.kana02) }}
                                {{ form_errors(form.kana.kana01) }}
                                {{ form_errors(form.kana.kana02) }}
                            </div>
                        </div>
                        {# 会社名 #}
                        <div id="detail_box__company_name" class="form-group">
                            {{ form_label(form.company_name) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.company_name) }}
                                {{ form_errors(form.company_name) }}
                            </div>
                        </div>
                        {# 住所：郵便番号 #}
                        <div id="detail_box__address" class="form-group">
                            {{ form_label(form.address) }}
                            <div id="detail_box__zip" class="col-sm-9 col-lg-10 input_zip form-inline">
                                〒{{ form_widget(form.zip.zip01) }}-{{ form_widget(form.zip.zip02) }}
                                {{ form_errors(form.zip) }}
                                {{ form_errors(form.zip.zip01) }}
                                {{ form_errors(form.zip.zip02) }}
                            </div>
                        </div>
                        {# 住所：都道府県 #}
                        <div class="form-group">
                            <div id="detail_box__pref" class="col-sm-offset-2 col-sm-9 col-lg-10 form-inline">
                                {{ form_widget(form.address.pref) }}
                                {{ form_errors(form.address.pref) }}
                            </div>
                        </div>
                        {# 住所：住所1 #}
                        <div class="form-group">
                            <div id="detail_box__addr01" class="col-sm-offset-2 col-sm-9 col-lg-10">
                                {{ form_widget(form.address.addr01, { attr : { placeholder : '市区町村名（例：千代田区神田神保町）'}} ) }}
                                {{ form_errors(form.address.addr01) }}
                            </div>
                        </div>
                        {# 住所：住所2 #}
                        <div class="form-group">
                            <div id="detail_box__addr02" class="col-sm-offset-2 col-sm-9 col-lg-10">
                                {{ form_widget(form.address.addr02, { attr : { placeholder : '番地・ビル名（例：1-3-5）' }}) }}
                                {{ form_errors(form.address.addr02) }}
                            </div>
                        </div>
                        {# メールアドレス #}
                        <div id="detail_box__email" class="form-group">
                            {{ form_label(form.email) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.email) }}
                                {{ form_errors(form.email) }}
                            </div>
                        </div>
                        {# 電話番号 #}
                        <div id="detail_box__tel" class="form-group">
                            {{ form_label(form.tel) }}
                            <div class="col-sm-9 col-lg-10 input_tel form-inline">
                                {{ form_widget(form.tel.tel01) }}-{{ form_widget(form.tel.tel02) }}-{{ form_widget(form.tel.tel03) }}
                                {{ form_errors(form.tel.tel01) }}
                                {{ form_errors(form.tel.tel02) }}
                                {{ form_errors(form.tel.tel03) }}
                            </div>
                        </div>
                        {# FAX番号 #}
                        <div id="detail_box__fox" class="form-group">
                            {{ form_label(form.fax) }}
                            <div class="col-sm-9 col-lg-10 input_tel form-inline">
                                {{ form_widget(form.fax.fax01) }}-{{ form_widget(form.fax.fax02) }}-{{ form_widget(form.fax.fax03) }}
                                {{ form_errors(form.fax.fax01) }}
                                {{ form_errors(form.fax.fax02) }}
                                {{ form_errors(form.fax.fax03) }}
                            </div>
                        </div>
                        {# パスワード #}
                        <div id="detail_box__password_first" class="form-group">
                            {{ form_label(form.password.first) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.password.first, { type : 'password'}) }}
                                {{ form_errors(form.password.first) }}
                            </div>
                        </div>
                        <div id="detail_box__password_second" class="form-group">
                            {{ form_label(form.password.second) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.password.second, { type : 'password'}) }}
                                {{ form_errors(form.password.second) }}
                            </div>
                        </div>
                        {# 性別 #}
                        <div id="detail_box__sex" class="form-group">
                            {{ form_label(form.sex) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.sex) }}
                                {{ form_errors(form.sex) }}
                            </div>
                        </div>
                        {# 職業 #}
                        <div id="detail_box__job" class="form-group">
                            {{ form_label(form.job) }}
                            <div class="col-sm-9 col-lg-10">
                                {{ form_widget(form.job) }}
                                {{ form_errors(form.job) }}
                            </div>
                        </div>
                        {# 生年月日 #}
                        <div id="detail_box__birth" class="form-group">
                            {{ form_label(form.birth) }}
                            <div class="col-sm-9 col-lg-10">
                                <div class="form-inline">
                                    {{ form_widget(form.birth) }}
                                    {{ form_errors(form.birth) }}
                                </div>
                            </div>
                        </div>
                        {# 所有ポイント #}
                        <div id="detail_box__point" class="form-group">
                            {{ form_label(form.point) }}
                            <div class="col-sm-9 col-lg-10">
                                <div class="form-inline">
                                    {{ form_widget(form.point) }}
                                    {{ form_errors(form.point) }}
                                </div>
                            </div>
                        </div>
                        {# エンティティ拡張の自動出力 #}
                        {% for f in form %}
                            {# auto_render有効時に出力 #}
                            {% if f.vars.eccube_form_options.auto_render %}
                                {# form_themeが設定されている場合にthemeを適用 #}
                                {% if f.vars.eccube_form_options.form_theme %}
                                    {% form_theme f f.vars.eccube_form_options.form_theme %}
                                {% endif %}
                                {{ form_row(f) }}
                            {% endif %}
                        {% endfor %}
                        <div class="extra-form">
                            {% for f in form.getIterator %}
                                {% if f.vars.name matches '[^plg*]' %}
                                    {{ form_row(f) }}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div><!-- /.box-body -->
            </div><!-- /.box -->

            {% if Customer.id %}
            <div id="address_box" class="box accordion">
                <div id="address_box__toggle" class="box-header toggle">
                    <h3 class="box-title">お届け先<svg class="cb cb-angle-down icon_down"> <use xlink:href="#cb-angle-down" /></svg></h3>
                </div>
                <div id="address_box__body" class="box-body accpanel">
                    {% if Customer.CustomerAddresses|length > 0 %}
                    <div id="address_box__list" class="table_list">
                        <div class="table-responsive with-border">
                            <table class="table table-striped">
                                <thead>
                                    <tr id="address_box__list_header">
                                        <th id="address_box__header_address_id">お届け先ID</th>
                                        <th id="address_box__header_address_name">お名前</th>
                                        <th id="address_box__header_address_addr">住所</th>
                                        <th id="address_box__header_address_tel">電話番号</th>
                                        <th id="address_box__header_menu_box">&nbsp;</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for CustomerAddress in Customer.CustomerAddresses %}
                                    <tr id="address_box__item--{{ CustomerAddress.id }}">
                                        <td id="address_box__address_id--{{ CustomerAddress.id }}" class="address_id">
                                            {{ CustomerAddress.id }}
                                        </td>
                                        <td id="address_box__address_name--{{ CustomerAddress.id }}" class="address_name">
                                            {{ CustomerAddress.name01 }}&nbsp;{{ CustomerAddress.name02 }}
                                        </td>
                                        <td id="address_box_address_addr--{{ CustomerAddress.id }}" class="address_addr">
                                            〒{{ CustomerAddress.zip01 }}-{{ CustomerAddress.zip02 }}　{{ CustomerAddress.Pref }}{{ CustomerAddress.addr01 }}{{ CustomerAddress.addr02 }}
                                        </td>
                                        <td id="address_box_address_tel--{{ CustomerAddress.id }}" class="address_tel">
                                            {{ CustomerAddress.tel01 }}-{{ CustomerAddress.tel02 }}-{{ CustomerAddress.tel03 }}
                                        </td>
                                        <td id="address_box__menu_box--{{ CustomerAddress.id }}" class="icon_edit">
                                            <div id="address_box__menu_box_toggle--{{ CustomerAddress.id }}" class="dropdown">
                                                <a class="dropdown-toggle" data-toggle="dropdown"><svg class="cb cb-ellipsis-h"> <use xlink:href="#cb-ellipsis-h" /></svg></a>
                                                <ul id="address_box__menu--{{ CustomerAddress.id }}" class="dropdown-menu dropdown-menu-right">
                                                    <li><a href="{{ url('admin_customer_delivery_edit', { 'id': Customer.id, 'did': CustomerAddress.id}) }}">編集</a></li>
                                                    <!--
                                                        <li><a href="{{ url('admin_customer_delivery_delete', { 'id': Customer.id, 'did': CustomerAddress.id}) }}" {{ csrf_token_for_anchor() }} data-method="delete" data-message="このお届け先情報を削除してもよろしいですか？">削除</a></li>
                                                    -->
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if Customer.CustomerAddresses|length < app.config.deliv_addr_max %}
                            <a href="{{ url('admin_customer_delivery_new', { id: Customer.id }) }}" class="btn btn-default">お届け先追加</a>
                        {% else %}
                            <span class="ec-errorMessage">お届け先登録の上限の{{ app.config.deliv_addr_max }}件に達しています。お届け先を入力したい場合は、削除か変更を行ってください</span>
                        {% endif %}
                    </div>
                    {% else %}
                    <div id="address_box__header" class="data-empty"><svg class="cb cb-inbox"> <use xlink:href="#cb-inbox" /></svg><p>データはありません</p>
                    </div>
                    <a href="{{ url('admin_customer_delivery_new', { id: Customer.id }) }}" class="btn btn-default">お届け先追加</a>
                    {% endif %}
                </div>
            </div>
            <div id="history_box" class="box accordion">
                <div id="history_box__toggle" class="box-header toggle">
                    <h3 class="box-title">購入履歴<svg class="cb cb-angle-down icon_down"> <use xlink:href="#cb-angle-down" /></svg></h3>
                </div><!-- /.box-header -->
                <div id="history_box__body" class="box-body accpanel">
                    {% if Customer.Orders|length > 0 %}
                    <div id="history_box__list" class="table_list">
                        <div class="table-responsive with-border">
                            <table class="table table-striped">
                                <thead>
                                    <tr id="history_box__list_header">
                                        <th id="history_box__header_order_date">注文日時</th>
                                        <th id="history_box__header_order_id">受注番号</th>
                                        <th id="history_box__header_order_code">受注コード</th>
                                        <th id="history_box__header_order_total">購入金額</th>
                                        <th id="history_box__header_commit_date">発送日</th>
                                        <th id="history_box__header_payment_method">支払方法</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for Order in Customer.Orders %}
                                    <tr id="history_box__item--{{ Order.id }}">
                                        <td id="history_box__order_date--{{ Order.id }}" class="member_id">
                                            {{ Order.order_date|date_format }}
                                        </td>
                                        <td id="history_box__order_id--{{ Order.id }}" class="member_name">
                                            <a href="{{ url('admin_order_edit', { 'id' : Order.id }) }}">{{ Order.id }}</a>
                                        </td>
                                        <td id="history_box__order_code--{{ Order.id }}" class="member_name">
                                            {{ Order.code }}
                                        </td>
                                        <td id="history_box__order_total--{{ Order.id }}" class="member_tel">
                                            {{ Order.total|price }}
                                        </td>
                                        <td id="history_box__commit_date--{{ Order.id }}" class="member_mail">
                                            {{ Order.shipping_date|date_format|default('未発送') }}
                                        </td>
                                        <td id="history_box__payment_method--{{ Order.id }}" class="member_mail">
                                            {{ Order.payment_method }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% else %}
                    <div id="history_box__header" class="data-empty"><svg class="cb cb-inbox"> <use xlink:href="#cb-inbox" /></svg><p>データはありません</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <div id="detail_box__footer" class="row hidden-xs hidden-sm">
                <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3 text-center btn_area">
                    <p><a href="{{ url('admin_customer_page', { page_no : app.session.get('eccube.admin.customer.search.page_no')|default('1') } ) }}?resume=1">検索画面に戻る</a></p>
                </div>
            </div>

        </div><!-- /.col -->

        <div id="aside_column" class="col-md-3">
            <div id="common_box" class="col_inner">
                <div id="button_box" class="box no-header">
                    <div id="button_box__body" class="box-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <div id="button_box__status" class="form-group">
                                    {{ form_widget(form.status) }}
                                    {{ form_errors(form.status) }}
                                </div>
                            </div>
                        </div>
                        <div id="button_box__insert_button" class="row text-center">
                            <div class="col-sm-6 col-sm-offset-3 col-md-12 col-md-offset-0">
                                <button class="btn btn-primary btn-block btn-lg" type="submit">会員情報を登録</button>
                            </div>
                        </div>
                    </div><!-- /.box-body -->
                </div><!-- /.box -->

                <div id="shop_note_box" class="box">
                    <div id="shop_note_box__header" class="box-header">
                        <h3 class="box-title">ショップ用メモ欄</h3>
                    </div><!-- /.box-header -->
                    <div id="shop_note_box__note" class="box-body">
                        {{ form_widget(form.note) }}
                        {{ form_errors(form.note) }}
                    </div>
                </div><!-- /.box -->

            </div>
        </div><!-- /.col -->
    </form>
</div>
{% endblock %}
