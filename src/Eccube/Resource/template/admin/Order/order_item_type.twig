{#
This file is part of EC-CUBE

Copyright(c) LOCKON CO.,LTD. All Rights Reserved.

http://www.lockon.co.jp/

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
#}
<script>
    // 受注明細行を追加する.
    function fnAddOrderItem($row, product_id, type, product_name) {
        var product_class_id = null;
        var price = null;
        var quantity = 1;
        var product_code = null;
        var tax_rate = 8;
        var tax_display_type = {{ constant('Eccube\\Entity\\Master\\TaxDisplayType::EXCLUDED') }};

        // 受注明細行を取得.
        var list = '#table-form-field';

        var prototype = $collectionHolder.data('prototype');
        index++;
        var newForm = prototype.replace(/__name__/g, index);
        $(list + ' tbody').append(newForm);
        var $lastRow = $(list + ' tbody > tr:last');

        $($lastRow).find('#order_OrderItems_' + index + '_Product').val(product_id);
        $($lastRow).find('#order_OrderItems_' + index + '_ProductClass').val(product_class_id);
        $($lastRow).find('#order_OrderItems_' + index + '_price').val(price);
        $($lastRow).find('#order_OrderItems_' + index + '_quantity').val(quantity); // コントローラ側で再取得するため、仮の値をセット
        $($lastRow).find('#order_OrderItems_' + index + '_tax_rate').val(tax_rate); // コントローラ側で再取得するため、仮の値をセット
        $($lastRow).find('#order_OrderItems_' + index + '_order_item_type').val(type);
        $($lastRow).find('#order_OrderItems_' + index + '_product_name').val(product_name);
        $($lastRow).find('#order_OrderItems_' + index + '_product_code').val(product_code);
        $($lastRow).find('#order_OrderItems_' + index + '_tax_display_type').val(tax_display_type);

        // モーダル閉じる.
        $('#addOrderItemType').modal('hide');

        // モーダルからのPOST時にのみ金額等をセットするため
        $('input:hidden[name="modal"]').val('modal');

        // 再計算のためsubmit.
        $('#form1').submit();

        return false;
    }
</script>


<table class="table table-striped table-sm mb-3">
    <thead class="table-active">
    <tr>
        <th class="pt-2 pb-2 pl-3">{{ 'admin.order.edit.label.add_item'|trans }}</th>
        <th class="pt-2 pb-2 pr-3"></th>
    </tr>
    </thead>

    <tbody>
    {% for OrderItemType in OrderItemTypes %}
        <form name="product_form{{ OrderItemType.id }}">
            {% set form = forms[OrderItemType.id] %}
            <tr>
                <td class="align-middle pl-3">{{ OrderItemType.name }}</td>
                <td class="align-middle pr-3 text-right">
                    <button type="button" class="btn btn-ec-actionIcon" onclick="fnAddOrderItem($(this).parent().parent(), null, {{ OrderItemType.id }}, '{{ OrderItemType.name }}')" name="mode" value="modal">
                        <i class="fa fa-plus fa-lg font-weight-bold text-secondary"></i>
                    </button>
                </td>
            </tr>
        </form>
    {% endfor %}
    </tbody>
</table>

